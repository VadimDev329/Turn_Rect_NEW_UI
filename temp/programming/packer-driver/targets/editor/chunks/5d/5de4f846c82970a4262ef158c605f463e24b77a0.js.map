{"version":3,"sources":["file:///D:/ENGINES/Cocos/PROJECTS/103_2/387/ST/Rect/Turn_Rect/assets/resources/scripts/Game_Turn5.ts"],"names":["_decorator","Component","Graphics","Node","Rect","Label","resources","Sprite","SpriteFrame","EventTarget","Input","math","eventTarget","ccclass","property","Game","type","row","col","url","count","score","onLoad","load","err","image","console","log","cut_out4","node","on","EventType","TOUCH_START","onTouchStart","schedule","_timer","start","sprf","height_image","originalSize","height","width_image","width","height_rect","width_rect","x","y","m","spr","sprite","i","j","clone","rect","String","addComponent","addChild","spriteFrame","setPosition","randomRangeInt","setRotationFromEuler","name","event","draw_grid","g","getComponent","lineWidth","moveTo","lineTo","stroke","target","angle","game_victory","timer","string","game_over","_score","go","children","scoreX","onDestroy","game_state","off","unschedule"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAAkCC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAyBC,MAAAA,W,OAAAA,W;AAAqBC,MAAAA,K,OAAAA,K;AAAcC,MAAAA,I,OAAAA,I;;;;;;;;;AAClKC,MAAAA,W,GAAc,IAAIH,WAAJ,E;OACd;AAAEI,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBd,U;;sBAIjBe,I,WADZF,OAAO,CAAC,MAAD,C,UAGHC,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAAEX;AAAP,OAAD,C,UAGRS,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAAEX;AAAP,OAAD,C,UAGRS,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAAEX;AAAP,OAAD,C,2BATb,MACaU,IADb,SAC0Bd,SAD1B,CACoC;AAAA;AAAA;;AAAA;;AAGE;AAHF;;AAMC;AAND;;AASM;AATN,eAWxBgB,GAXwB,GAWV,CAXU;AAWP;AAXO,eAYxBC,GAZwB,GAYV,CAZU;AAYP;AAZO,eAcxBC,GAdwB,GAcV,SAdU;AAcC;AAdD,eAgBxBC,KAhBwB,GAgBR,EAhBQ;AAgBJ;AAhBI,eAiBxBC,KAjBwB,GAiBR,CAjBQ;AAAA;;AAiBL;AAE3BC,QAAAA,MAAM,GAAG;AACL;AACAhB,UAAAA,SAAS,CAACiB,IAAV,CAAe,wBAAf,EAAyCf,WAAzC,EAAsD,CAACgB,GAAD,EAAMC,KAAN,KAAgB;AAClE,gBAAID,GAAJ,EAAS;AACLE,cAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACH;;AACD,iBAAKI,QAAL,CAAcH,KAAd;AACH,WALD;AAMA,eAAKI,IAAL,CAAUC,EAAV,CAAa3B,IAAI,CAAC4B,SAAL,CAAeC,WAA5B,EAAyC,KAAKC,YAA9C,EAA4D,IAA5D,EARK,CAQ8D;;AAEnE,eAAKC,QAAL,CAAc,KAAKC,MAAnB,EAA0B,CAA1B,EAVK,CAUyB;AAEjC;;AACDC,QAAAA,KAAK,GAAE,CACN;;AAEDR,QAAAA,QAAQ,CAACS,IAAD,EAAkB;AAEtB,cAAIC,YAAoB,GAAGD,IAAI,CAACE,YAAL,CAAkBC,MAA7C,CAFsB,CAE+B;;AACrD,cAAIC,WAAmB,GAAGJ,IAAI,CAACE,YAAL,CAAkBG,KAA5C,CAHsB,CAG6B;;AACnD,cAAIC,WAAmB,GAAGL,YAAY,GAAC,KAAKpB,GAA5C,CAJsB,CAI2B;;AACjD,cAAI0B,UAAkB,GAAGH,WAAW,GAAC,KAAKxB,GAA1C,CALsB,CAKyB;;AAC/C,cAAI4B,CAAQ,GAAG,CAAf,CANsB,CAMJ;;AAClB,cAAIC,CAAQ,GAAG,CAAf,CAPsB,CAOJ;;AAClB,cAAIC,CAAQ,GAAG,CAAf,CARsB,CAQJ;;AAClB,cAAIC,GAAe,GAAG,IAAIxC,WAAJ,EAAtB,CATsB,CASmB;;AACzC,cAAIyC,MAAa,GAAG,IAApB,CAVsB,CAUI;;AAC1B,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKjC,GAAzB,EAA8BiC,CAAC,EAA/B,EAAmC;AAC/B,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKjC,GAAzB,EAA8BiC,CAAC,EAA/B,EAAmC;AACnCH,cAAAA,GAAG,GAAGX,IAAI,CAACe,KAAL,EAAN,CADmC,CACf;;AACpBJ,cAAAA,GAAG,CAACK,IAAJ,GAAW,IAAIjD,IAAJ,CAAS+C,CAAC,GAACP,UAAX,EAAsBM,CAAC,GAACP,WAAxB,EAAoCC,UAApC,EAA+CD,WAA/C,CAAX,CAFmC,CAEqC;;AACxEM,cAAAA,MAAM,GAAG,IAAI9C,IAAJ,CAAS,WAASmD,MAAM,CAACJ,CAAC,GAACC,CAAH,CAAxB,EAA+BI,YAA/B,CAA4ChD,MAA5C,CAAT,CAHmC,CAG2B;;AAC9D,mBAAKsB,IAAL,CAAU2B,QAAV,CAAmBP,MAAM,CAACpB,IAA1B,EAJmC,CAIF;;AACjCoB,cAAAA,MAAM,CAACQ,WAAP,GAAqBT,GAArB,CALmC,CAKT;AAC1B;;AACAF,cAAAA,CAAC,GAAGH,WAAW,GAAGO,CAAd,GAAkBZ,YAAY,GAAC,CAA/B,GAAmCK,WAAW,GAAC,CAAnD,CAPmC,CAOmB;;AACtDE,cAAAA,CAAC,GAAGD,UAAU,GAAGO,CAAb,GAAiBV,WAAW,GAAC,CAA7B,GAAiCG,UAAU,GAAC,CAAhD,CARmC,CAQgB;;AACnDK,cAAAA,MAAM,CAACpB,IAAP,CAAY6B,WAAZ,CAAwBb,CAAxB,EAA0BC,CAAC,GAAC,CAAC,CAA7B,EAA+B,CAA/B,EATmC,CASA;AACpC;;AACAC,cAAAA,CAAC,GAAGpC,IAAI,CAACgD,cAAL,CAAoB,CAApB,EAAsB,GAAtB,CAAJ,CAXoC,CAWJ;;AAChC,kBAAGZ,CAAC,GAAC,CAAF,IAAOA,CAAC,IAAE,EAAb,EAAiBA,CAAC,GAAG,EAAJ,CAZmB,CAYX;;AACzB,kBAAGA,CAAC,GAAC,EAAF,IAAQA,CAAC,IAAE,GAAd,EAAmBA,CAAC,GAAG,GAAJ;AACnB,kBAAGA,CAAC,GAAC,GAAF,IAASA,CAAC,IAAE,GAAf,EAAoBA,CAAC,GAAG,GAAJ;AACpB,kBAAGA,CAAC,GAAC,GAAF,IAASA,CAAC,IAAE,GAAf,EAAoBA,CAAC,GAAG,CAAJ;AACpBE,cAAAA,MAAM,CAACpB,IAAP,CAAY+B,oBAAZ,CAAiC,CAAjC,EAAmC,CAAnC,EAAqCb,CAArC,EAhBoC,CAgBK;AACzC;;AACAE,cAAAA,MAAM,CAACpB,IAAP,CAAYgC,IAAZ,GAAmBP,MAAM,CAACT,CAAD,CAAN,GAAU,GAAV,GAAcS,MAAM,CAACR,CAAD,CAApB,GAAwB,GAAxB,GAA4BQ,MAAM,CAACP,CAAD,CAArD,CAlBoC,CAkBsB;;AAC1DrB,cAAAA,OAAO,CAACC,GAAR,CAAY,yBAAuBsB,MAAM,CAACpB,IAAP,CAAYgC,IAA/C,EAnBoC,CAoBpC;;AACAZ,cAAAA,MAAM,CAACpB,IAAP,CAAYC,EAAZ,CAAe3B,IAAI,CAAC4B,SAAL,CAAeC,WAA9B,EAA4C8B,KAAD,IAAe,CAAE,CAA5D,EAA8D,IAA9D,EArBoC,CAqBiC;AACnE;AACJ;AACJ;;AACDC,QAAAA,SAAS,CAAE9C,GAAF,EAAeC,GAAf,EAA4BsB,MAA5B,EAA4CE,KAA5C,EAA0D;AAAE;AAC5D;AACL,cAAIG,CAAQ,GAAG,CAAf;AACA,cAAIC,CAAQ,GAAG,CAAf;AACA,gBAAMkB,CAAC,GAAG,KAAKC,YAAL,CAAkB/D,QAAlB,CAAV;AACA8D,UAAAA,CAAC,CAACE,SAAF,GAAc,CAAd;;AACA,eAAI,IAAIhB,CAAS,GAAG,CAApB,EAAuBA,CAAC,GAAGjC,GAAG,GAAC,CAA/B,EAAkCiC,CAAC,EAAnC,EAAsC;AAAE;AACxCc,YAAAA,CAAC,CAACG,MAAF,CAAS,CAAT,EAAWrB,CAAX;AACAkB,YAAAA,CAAC,CAACI,MAAF,CAAS1B,KAAK,GAACxB,GAAf,EAAmB4B,CAAnB;AACAA,YAAAA,CAAC,GAAGA,CAAC,GAAGN,MAAR;AACC;;AACDK,UAAAA,CAAC,GAAC,CAAF;AACAC,UAAAA,CAAC,GAAC,CAAF;;AACA,eAAI,IAAII,CAAS,GAAG,CAApB,EAAuBA,CAAC,GAAGhC,GAAG,GAAC,CAA/B,EAAkCgC,CAAC,EAAnC,EAAsC;AAAE;AACxCc,YAAAA,CAAC,CAACG,MAAF,CAAStB,CAAT,EAAW,CAAX;AACAmB,YAAAA,CAAC,CAACI,MAAF,CAASvB,CAAT,EAAWL,MAAM,GAACvB,GAAlB;AACA4B,YAAAA,CAAC,GAAGA,CAAC,GAAGH,KAAR;AACC;;AACDsB,UAAAA,CAAC,CAACK,MAAF;AACH;;AACDpC,QAAAA,YAAY,CAAC6B,KAAD,EAAW;AAAE;AACrBA,UAAAA,KAAK,CAACQ,MAAN,CAAaC,KAAb,IAAoB,EAApB;AACA,cAAGT,KAAK,CAACQ,MAAN,CAAaC,KAAb,IAAsB,GAAzB,EAA8BT,KAAK,CAACQ,MAAN,CAAaC,KAAb,GAAqB,CAArB;AAC9B,eAAKC,YAAL;AACH;;AACDrC,QAAAA,MAAM,GAAE;AAAE;AACN,eAAKf,KAAL,GADI,CACU;;AACd,cAAI,KAAKqD,KAAT,EAAgB,KAAKA,KAAL,CAAWC,MAAX,GAAoB,UAAUpB,MAAM,CAAC,KAAKlC,KAAN,CAApC,CAFZ,CAE8D;;AAChE,cAAG,KAAKA,KAAL,IAAY,CAAf,EAAiB;AAAE;AACjB,iBAAKuD,SAAL,GADe,CACG;AAClB;AACH;AACJ;;AACDC,QAAAA,MAAM,GAAE;AACJ,cAAIC,EAAS,GAAG,CAAhB;;AACA,eAAK,IAAI3B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhC,GAAL,GAAS,KAAKD,GAAlC,EAAuCiC,CAAC,EAAxC,EAA4C;AAAE;AAC1C,gBAAG,KAAKrB,IAAL,CAAUiD,QAAV,CAAmB5B,CAAnB,EAAsBqB,KAAtB,IAA+B,CAAlC,EAAqCM,EAAE,GADC,CACG;;AAC/C,iBAAKxD,KAAL,GAAawD,EAAb,CAF4C,CAE1B;AACjB;;AACD,cAAI,KAAKE,MAAT,EAAiB,KAAKA,MAAL,CAAYL,MAAZ,GAAqB,WAAW,KAAKrD,KAArC;AACpB;;AACDmD,QAAAA,YAAY,GAAE;AAAE;AACZ,eAAKI,MAAL;;AACA,cAAG,KAAKvD,KAAL,IAAc,KAAKH,GAAL,GAAS,KAAKD,GAA/B,EAAmC;AAAE;AACjC,iBAAK+D,SAAL;AACA,gBAAI,KAAKC,UAAT,EAAqB,KAAKA,UAAL,CAAgBP,MAAhB,GAAyB,UAAzB,CAFU,CAGhC;AACF;AACJ;;AACDC,QAAAA,SAAS,GAAE;AAAE;AACT,eAAKK,SAAL,GADO,CACW;;AAClB,cAAI,KAAKC,UAAT,EAAqB,KAAKA,UAAL,CAAgBP,MAAhB,GAAyB,WAAzB;AACxB;;AACDM,QAAAA,SAAS,GAAG;AAAE;AACV,eAAKnD,IAAL,CAAUqD,GAAV,CAAcxE,KAAK,CAACqB,SAAN,CAAgBC,WAA9B,EAA2C,KAAKC,YAAhD,EAA8D,IAA9D;;AACA,eAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhC,GAAL,GAAS,KAAKD,GAAlC,EAAuCiC,CAAC,EAAxC,EAA2C;AAC1C,iBAAKrB,IAAL,CAAUiD,QAAV,CAAmB5B,CAAnB,EAAsBgC,GAAtB,CAA0B/E,IAAI,CAAC4B,SAAL,CAAeC,WAAzC,EAAuD8B,KAAD,IAAW,CAAE,CAAnE,EAAqE,IAArE;AACA;;AACD,eAAKqB,UAAL,CAAgB,KAAKhD,MAArB,EALQ,CAKsB;AACjC;;AAnI+B,O;;;;;iBAGJ,I;;;;;;;iBAGD,I;;;;;;;iBAGK,I","sourcesContent":["import { _decorator, Component, Graphics, Node, Rect, rect, JsonAsset, Scheduler, Label, resources, Sprite, SpriteFrame, Vec2, Vec3, EventTarget,  Event, Input, input, math} from 'cc';\r\nconst eventTarget = new EventTarget(); \r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n@ccclass('Game')\r\nexport class Game extends Component {\r\n\r\n    @property({type: Label})\r\n    public scoreX: Label|null = null; // Для вывода\r\n    \r\n    @property({type: Label})\r\n    public timer: Label|null = null; // Для вывода текста \"Game Over\"\r\n    \r\n    @property({type: Label})\r\n    public game_state: Label|null = null; // Для вывода текста \"Game Over\"\r\n\r\n    private row: number = 6; // Количество строк сетки                \r\n    private col: number = 6; // Количество колонок сетки\r\n   \r\n    private url: string = \"images/\"; // Адрес \"картинок\"\r\n\r\n    private count: number = 80; // Таймер\r\n    private score: number = 0; // this.col * this.row;\r\n\r\n    onLoad() {\r\n        //----------------------------------------------------------------------------------------------------------------\r\n        resources.load('images/110/spriteFrame', SpriteFrame, (err, image) => {\r\n            if (err) {\r\n                console.log(err);\r\n            }\r\n            this.cut_out4(image);\r\n        });\r\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this); // Регистрация события \"родителя\" this.node\r\n        \r\n        this.schedule(this._timer,1); //1,3\r\n      \r\n    }\r\n    start(){\r\n    }\r\n    \r\n    cut_out4(sprf:SpriteFrame){\r\n\r\n        let height_image: number = sprf.originalSize.height; // Высота исходной картинки\r\n        let width_image: number = sprf.originalSize.width; // Ширина исходной картинки\r\n        let height_rect: number = height_image/this.col; // Высота вырезаного прямоугольника\r\n        let width_rect: number = width_image/this.row; // Ширина вырезаного прямоугольника\r\n        let x:number = 0; // Координата х прямоугольника\r\n        let y:number = 0; // Координата у прямоугольника\r\n        let m:number = 0; // Математический результат (random)\r\n        let spr:SpriteFrame = new SpriteFrame(); // Вспомогательный фрейм\r\n        let sprite:Sprite = null; // Очередной спрайт\r\n        for (let i = 0; i < this.row; i++) {\r\n            for (let j = 0; j < this.col; j++) {\r\n            spr = sprf.clone(); // Клонирование текстуры\r\n            spr.rect = new Rect(j*width_rect,i*height_rect,width_rect,height_rect); // Вырезать прямоугольник из текстуры\r\n            sprite = new Node(\"Sprite\"+String(i*j)).addComponent(Sprite); // Инициализация очередного спрайта\r\n            this.node.addChild(sprite.node); // Добавить спрайт родительской ноде\r\n            sprite.spriteFrame = spr; // Присвоить вырезаную текстуру спрайту\r\n            //----------------Position----------------------------------------------\r\n            y = height_rect * i - height_image/2 + height_rect/2; // Получение х очередного прямоугольника\r\n            x = width_rect * j - width_image/2 + width_rect/2; // Получение у очередного прямоугольника\r\n            sprite.node.setPosition(x,y*-1,0); // Установить позицию очередному прямоугольнику\r\n           //-----------------Angle-------------------------------------------------\r\n           m = math.randomRangeInt(0,360); // Случайное число в диапазоне 0 - 360(целые числа)\r\n           if(m>0 && m<=90) m = 90; // Выбор одного из 4 значений\r\n           if(m>90 && m<=180) m = 180;\r\n           if(m>180 && m<=270) m = 270;\r\n           if(m>270 && m<=360) m = 0;\r\n           sprite.node.setRotationFromEuler(0,0,m); // Поворот \"piece\"\r\n           //-----------------Data---------------------------------------------------- \r\n           sprite.node.name = String(x)+\" \"+String(y)+\" \"+String(m); // Запись целевых: х,у и angle в память \"прямоугольника\"\r\n           console.log('sprite2.node.name = '+sprite.node.name);\r\n           //------------------Event------------------------------------------------\r\n           sprite.node.on(Node.EventType.TOUCH_START, (event:any) => {}, this); // // Регистрация события \"детей\"\r\n            }\r\n        }        \r\n    }\r\n    draw_grid( row: number, col: number, height: number, width: number){ // Нарисовать сетку\r\n             //строка,      колонка,     высота,         ширина        \r\n        let x:number = 0;\r\n        let y:number = 0;   \r\n        const g = this.getComponent(Graphics);\r\n        g.lineWidth = 3;\r\n        for(let i: number = 0; i < row+1; i++){ // Вертикальные линии\r\n        g.moveTo(0,y);\r\n        g.lineTo(width*col,y);\r\n        y = y + height;\r\n        }\r\n        x=0;\r\n        y=0;\r\n        for(let i: number = 0; i < col+1; i++){ // Горизонтальные линии\r\n        g.moveTo(x,0);\r\n        g.lineTo(x,height*row);\r\n        x = x + width;\r\n        }\r\n        g.stroke();\r\n    } \r\n    onTouchStart(event:any){ // Обработка события (клик по целевой ноде)\r\n        event.target.angle+=90;\r\n        if(event.target.angle == 360) event.target.angle = 0;\r\n        this.game_victory();\r\n    } \r\n    _timer(){ // Таймер\r\n        this.count--; // Обратный счет;\r\n        if (this.timer) this.timer.string = \"TIME \" + String(this.count); // Отображение оставшегося времени \r\n          if(this.count==0){ // Если время истекло\r\n            this.game_over(); // Конец игры\r\n            //this.unschedule(this._timer); // Остановка таймера\r\n        }     \r\n    } \r\n    _score(){\r\n        let go:number = 0;\r\n        for (let i = 0; i < this.col*this.row; i++) { // Количество колонок сетки на количество строк сетки = количество \"pieces\"\r\n            if(this.node.children[i].angle == 0) go++; // Проверка окончания игры \"Победой\"\r\n        this.score = go;  // \"Счёт\"\r\n        }\r\n        if (this.scoreX) this.scoreX.string = \"Score \" + this.score;\r\n    } \r\n    game_victory(){ // Проверка окончания игры\r\n        this._score();\r\n        if(this.score == this.col*this.row){ // Если все углы равны нулю.\r\n            this.onDestroy();\r\n            if (this.game_state) this.game_state.string = \"Victory!\";\r\n           // this.unschedule(this._timer); // Остановка таймера\r\n        } \r\n    }  \r\n    game_over(){ // Конец игры - неудача\r\n        this.onDestroy(); // Обнулить слушателей событий\r\n        if (this.game_state) this.game_state.string = \"Game Over\"; \r\n    } \r\n    onDestroy (){ // Обнулить слушателей\r\n        this.node.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        for (let i = 0; i < this.col*this.row; i++){\r\n         this.node.children[i].off(Node.EventType.TOUCH_START, (event) => {}, this);\r\n        } \r\n        this.unschedule(this._timer); // Остановка таймера\r\n    } \r\n}\r\n\r\n\r\n"]}